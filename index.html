<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>단어장 + 번역기</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .tooltip {
      position: absolute;
      background: #222;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.9rem;
      pointer-events: none;
      z-index: 9999;
      display: none;
    }
    .word-entry {
      margin: 5px 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>📚 단어장 + 자동 번역기</h1>
  <input type="text" id="wordInput" placeholder="단어 입력" />
  <button onclick="addWord()">추가</button>  <h2>✨ 단어 목록</h2>
  <div id="wordList"></div>  <p style="margin-top: 3rem;">⚔️ 단어를 드래그하면 번역 툴팁이 나타납니다.</p>
  <div id="tooltip" class="tooltip"></div>  <script>
    const tooltip = document.getElementById("tooltip");
    const wordInput = document.getElementById("wordInput");
    const wordList = document.getElementById("wordList");

    let vocab = JSON.parse(localStorage.getItem("vocab") || "[]");

    async function translateText(text) {
      if (!("Translator" in window)) {
        return "⚠️ 이 브라우저는 번역 API를 지원하지 않습니다.";
      }
      try {
        const translator = await Translator.create({
          sourceLanguage: "en",
          targetLanguage: "ko",
        });
        const result = await translator.translate(text);
        return result;
      } catch (e) {
        return "번역 실패: " + e.message;
      }
    }

    async function addWord() {
      const word = wordInput.value.trim();
      if (!word) return;
      const meaning = await translateText(word);
      vocab.push({ word, meaning });
      localStorage.setItem("vocab", JSON.stringify(vocab));
      renderList();
      wordInput.value = "";
    }

    function renderList() {
      wordList.innerHTML = vocab.map(entry => `
        <div class="word-entry">
          <strong>${entry.word}</strong><br>
          뜻: ${entry.meaning || "(불러오는 중...)"}
        </div>
      `).join("");
    }

    renderList();

    document.addEventListener("mouseup", async (e) => {
      const sel = window.getSelection().toString().trim();
      if (sel && /^[a-zA-Z\s]+$/.test(sel)) {
        const translated = await translateText(sel);
        tooltip.innerText = translated;
        tooltip.style.top = `${e.pageY + 10}px`;
        tooltip.style.left = `${e.pageX + 10}px`;
        tooltip.style.display = "block";
      } else {
        tooltip.style.display = "none";
      }
    });

    document.addEventListener("click", () => {
      tooltip.style.display = "none";
    });
  </script></body>
</html>
